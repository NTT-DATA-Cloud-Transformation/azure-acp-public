parameters:
    - name: sc
      displayName: Service Connection Name
      type: string
      default: ACP-SC-DevOps
    
    - name: loc
      displayName: Location
      type: string
      default: WestEurope
      values:
      - WestEurope
      - EastUS
      - EastUS2
    
    - name: sid
      displayName: Subscription ID
      type: string
      default: 38150324-5c71-42af-b409-0b011c15608f
    
    - name: rg
      displayName: Resource Group Name
      type: string
      default: hejazi04Pipeline

trigger:
    - none
    
pool:
      vmImage: ubuntu-latest
stages:
    - stage: BuildInfra
      jobs:
      - job: ActiveDirectoryVM
        steps:
        - task: AzureResourceManagerTemplateDeployment@3
          displayName: Create Active Directory VM
          inputs:
            deploymentScope: 'Resource Group'
            azureResourceManagerConnection: ${{ parameters.sc }}
            subscriptionId: ${{ parameters.sid }}
            action: 'Create Or Update Resource Group'
            resourceGroupName: ${{ parameters.rg }}
            location: ${{ parameters.loc }}
            templateLocation: 'Linked artifact'
            csmFile: 'PoCDemo/ActiveDirectory/azuredeploy.json'
            deploymentMode: 'Incremental'
    